(window.webpackJsonp=window.webpackJsonp||[]).push([[240],{1446:function(t,a,s){"use strict";s.r(a);var e=s(15),n=Object(e.a)({},(function(){var t=this,a=t.$createElement,e=t._self._c||a;return e("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[e("h1",{attrs:{id:"成员变更的问题"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#成员变更的问题"}},[t._v("#")]),t._v(" 成员变更的问题")]),t._v(" "),e("p",[t._v("在日常工作中，你可能会遇到服务器故障的情况，这时你就需要替换集群中的服务器。如果遇到需要改变数据副本数的情况，则需要增加或移除集群中的服务器。总的来说，在日常工作中，集群中的服务器数量是会发生变化的。")]),t._v(" "),e("p",[t._v("讲到这儿，也许你会问:“Raft 是共识算法，对集群成员进行变更时(比如 台服务器)，会不会因为集群分裂，出现 2 个领导者呢?”")]),t._v(" "),e("p",[t._v("我先介绍一下“配置”这个词儿。配置是成员变更中一个非常重要的概念，我建议你这么理解:它就是在说集群是哪些 节点组成的，是集群各节点地址信息的集合。比如节点 A、B、C 组成的集群，那么集群的 配置就是[A, B, C]集合。")]),t._v(" "),e("p",[t._v("假设我们有一个由节点 A、B、C 组成的 Raft 集群，现在我们需要增加数据副本数，增加 2 个副本(也就是增加 2 台服务器)，扩展为由节点 A、B、C、D、E， 5 个节点组成的新集群。那么 Raft 算法是如何保障在集群配置变更时，集群能稳定运行，不出现 2 个领导者呢?")]),t._v(" "),e("p",[t._v("在我看来，在集群中进行成员变更的最大风险是，可能会同时出现 2 个领导者。比如在进行成员变更时，节点 A、B 和 C 之间发生了分区错误，节点 A、B 组成旧配置中的“大多 数”，也就是变更前的 3 节点集群中的“大多数”，那么这时的领导者(节点 A)依旧是 领导者。")]),t._v(" "),e("p",[t._v("另一方面，节点 C 和新节点 D、E 组成了新配置的“大多数”，也就是变更后的 5 节点集 群中的“大多数”，它们可能会选举出新的领导者(比如节点 C)。那么这时，就出现了同 时存在 2 个领导者的情况。")]),t._v(" "),e("p",[e("img",{attrs:{src:s(805),alt:"img"}})]),t._v(" "),e("p",[t._v("解决这个问题"),e("strong",[t._v("最常用的方法就是单节点变更。")])])])}),[],!1,null,null,null);a.default=n.exports},805:function(t,a,s){t.exports=s.p+"assets/img/image-20211113193605230.a1932e5a.png"}}]);