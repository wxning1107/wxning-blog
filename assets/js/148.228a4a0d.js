(window.webpackJsonp=window.webpackJsonp||[]).push([[148],{464:function(t,e,n){t.exports=n.p+"assets/img/image-20220306145553298.0c4fabe9.png"},956:function(t,e,n){"use strict";n.r(e);var l=n(15),s=Object(l.a)({},(function(){var t=this,e=t.$createElement,l=t._self._c||e;return l("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[l("h1",{attrs:{id:"online-ddl-重建表怎么做的"}},[l("a",{staticClass:"header-anchor",attrs:{href:"#online-ddl-重建表怎么做的"}},[t._v("#")]),t._v(" Online DDL 重建表怎么做的？")]),t._v(" "),l("p",[t._v("MySQL 5.6 版本开始引入的 Online DDL，重建表的流程：")]),t._v(" "),l("ul",[l("li",[l("p",[t._v("建立一个临时文件，扫描表 A 主键的所有数据页；")])]),t._v(" "),l("li",[l("p",[t._v("用数据页中表 A 的记录生成 B+ 树，存储到临时文件中；")])]),t._v(" "),l("li",[l("p",[t._v("生成临时文件的过程中，将所有对 A 的操作记录在一个日志文件（row log）中，对应的是图中 state2 的状态；")])]),t._v(" "),l("li",[l("p",[t._v("临时文件生成后，将日志文件中的操作应用到临时文件，得到一个逻辑数据上与表 A 相同的数据文件，对应的就是图中 state3 的状态；")])]),t._v(" "),l("li",[l("p",[t._v("用临时文件替换表 A 的数据文件。")])])]),t._v(" "),l("p",[l("img",{attrs:{src:n(464),alt:"img"}})]),t._v(" "),l("p",[t._v("可以看到，由于日志文件记录和重放操作这个功能的存在，这个方案在重建表的过程中，允许对表 A 做增删改操作。这也就是 Online DDL 名字的来源。")])])}),[],!1,null,null,null);e.default=s.exports}}]);