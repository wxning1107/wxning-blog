(window.webpackJsonp=window.webpackJsonp||[]).push([[53],{1056:function(t,s,v){"use strict";v.r(s);var _=v(15),n=Object(_.a)({},(function(){var t=this,s=t.$createElement,_=t._self._c||s;return _("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[_("h1",{attrs:{id:"tcc协议-try-confirm-cancel"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#tcc协议-try-confirm-cancel"}},[t._v("#")]),t._v(" TCC协议(Try-Confirm-Cancel)")]),t._v(" "),_("p",[t._v("TCC 是 Try(预留)、Confirm(确认)、Cancel(撤销) 3 个操作的简称，它包含了预留、确认或撤销这 2 个阶段。那么你如何使用 TCC 协议，解决苏秦面临的问题呢?")]),t._v(" "),_("p",[t._v("首先，我们先"),_("strong",[t._v("进入到预留阶段")]),t._v("，大致的步骤如下:")]),t._v(" "),_("p",[_("img",{attrs:{src:v(650),alt:"img"}})]),t._v(" "),_("p",[t._v("第一步，苏秦分别发送消息通知赵、魏、韩，让他们预留明天的时间和相关资源。然后苏秦实现确认操作(明天攻打秦国)，和撤销操作(取消明天攻打秦国)。")]),t._v(" "),_("p",[t._v("第二步，苏秦收到赵、魏、韩的预留答复，都是 OK。")]),t._v(" "),_("p",[t._v("如果预留阶段的执行都没有问题，就进入"),_("strong",[t._v("确认阶段")]),t._v("，大致步骤如下:")]),t._v(" "),_("p",[_("img",{attrs:{src:v(651),alt:"img"}})]),t._v(" "),_("p",[t._v("第一步，苏秦执行确认操作，通知赵、魏、韩明天攻打秦国。")]),t._v(" "),_("p",[t._v("第二步，收到确认操作的响应，完成分布式事务。")]),t._v(" "),_("p",[t._v("如果预留阶段执行出错，比如赵的一部分军队还在赶来的路上，无法出兵，那么就进入撤销 "),_("strong",[t._v("阶段")]),t._v("，大致步骤如下:")]),t._v(" "),_("p",[_("img",{attrs:{src:v(652),alt:"img"}})]),t._v(" "),_("p",[t._v("第一步，苏秦执行撤销操作，通知赵、魏、韩取消明天攻打秦国的计划。")]),t._v(" "),_("p",[t._v("第二步，收到撤销操作的响应。")]),t._v(" "),_("p",[t._v("其实在我看来，TCC 本质上是补偿事务，"),_("strong",[t._v("它的核心思想是针对每个操作都要注册一个与其 对应的确认操作和补偿操作(也就是撤销操作)。")]),t._v(" 它是一个业务层面的协议，你也可以将 TCC 理解为编程模型，TCC 的 3 个操作是需要在业务代码中编码实现的，为了实现一致性，确认操作和补偿操作必须是等幂的，因为这 2 个操作可能会失败重试。")]),t._v(" "),_("p",[t._v("另外，TCC 不依赖于数据库的事务，而是在业务中实现了分布式事务，这样能减轻数据库 的压力，但对业务代码的入侵性也更强，实现的复杂度也更高。所以，我推荐在需要分布式事务能力时，优先考虑现成的事务型数据库(比如 MySQL XA)，当现有的事务型数据库 不能满足业务的需求时，再考虑基于 TCC 实现分布式事务。")])])}),[],!1,null,null,null);s.default=n.exports},650:function(t,s,v){t.exports=v.p+"assets/img/image-20211109132314607.b3065cf9.png"},651:function(t,s,v){t.exports=v.p+"assets/img/image-20211109132356714.e21153ae.png"},652:function(t,s,v){t.exports=v.p+"assets/img/image-20211109132455017.73f1f35b.png"}}]);